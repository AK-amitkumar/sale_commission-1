{% extends "pos/base.html" %}
{% load i18n %}
{% load dajaxice_templatetags %}
{% load inplace_edit %}
    {% block css %}
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/pos.css" />
        <style type="text/css">
            @import "{{ STATIC_URL }}css/jquery.keypad.css";
        </style>
    {% endblock css %}
    {% block js %}
        {% dajaxice_js_import %}
        <script src="{{ STATIC_URL }}js/jquery-1.7.2.min.js" type="text/javascript"></script>
        {% inplace_static %}
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.keypad.js"></script>
        <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.keypad-es.js"></script>
        <script type="text/javascript">
            function my_callback(data){
                window.location.reload()
            }
        </script>
    {% endblock %}
{% block izquierda %}
    <div id="current-order">
        <table>
            <thead>
                <tr>
                    <td>Producto</td>
                    <td>Precio</td>
                    <td>Descuento (%)</td>
                    <td>Cantidad</td>
                    <td>Total</td>
                </tr>
            </thead>
            <tbody id="current-order-content">
                {% for p in pos_order.products %}
                    <tr>
                        <td>{{ p.product_name }}<span style="float:right;"><a href="{% url eliminar_producto mesa p.id %}"><img src="{{ STATIC_URL }}img/eliminar.gif"/></a></span></td>
                        <td>{{ p.precio }} &euro;</td>
                        <td>{% inplace_edit "p.descuento|floatformat:2" %}</td>
                        <td>{% inplace_edit "p.cantidad" %}</td>
                        <td>{{ p.total|floatformat:2 }} &euro;</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <footer>
        <ul id="amounts">
            <li>
                Total:
                <span id="total">{{ pos_order.total|floatformat:2 }} &euro;</span>
            </li>
        </ul>
        <div id="paypad">
            {% if metodos_pago %}
                {% for p in metodos_pago %}
                    <a href="{% url pagar mesa p.journal_id.id %}">
                        <button cash-register-id="6" class="payment-button">
                            {{ p.journal_id.name }}
                        </button>
                    </a>
                    <br>
                {% endfor %}
            {% else %}
                <a href="{% url open_cash %}">
                        <button cash-register-id="6" class="payment-button">
                            {% trans "Abrir cajas" %}
                        </button>
                </a>
                <br>
            {% endif %}
        </div>
        <script>
            function limpiaMesa(){
                var x;

                var code=prompt("Por favor, indique su código para eliminar la mesa.","");

                if (code!=null){
                  location.href="/{{mesa}}/borrar/"+code+"/";
                }
            }
        </script>
        <div style="float:right;">
            <a onclick="limpiaMesa()" title="Liberar mesa">
                <img src="{{ STATIC_URL }}img/eliminar.png" alt="Liberar mesa" />
            </a>
        </div>
    </footer>
{% endblock izquierda %}
{% block derecha %}

    <div class="step-screen selected-step" id="products-screen" style="display: block;">
        <div id="products-screen-categories">
            <header>
                <ol class="breadcrumb">
                    <li class="oe-pos-categories-list">
                        <a href="/">
                            <img class="homeimg" src="{{ STATIC_URL }}img/home.png">
                        </a>
                    </li>
                </ol>
                
                <div class="searchbox">
                    <form method="get" action="{% url search mesa %}" >{% csrf_token %}
                        <input type="text" name="q">
                        <input type="hidden" name="m" value="{{ mesa }}">
                        <img src="{{ STATIC_URL }}img/search_reset.gif" class="search-clear" />
                        
                    </form>
                </div>
                
            </header>
            <div id="categories" style="margin-left:5px;">
                <ol>
                    {% if "category" in request.path %}
                        <li class="oe-pos-categories-list">
                            <a class="button" href="{% url place mesa %}">
                            <strong>{% trans "Todas las categorías" %}</strong></a>
                        </li>
                    {% endif %}
                    {% for category in caterogies %} 
                    <li class="oe-pos-categories-list">
                        <a class="button" href="{% url category mesa category.id %}">
                        <strong>{{ category.name }}</strong></a>
                    </li>
                    {% endfor %}
                </ol>
            </div>
        </div>
        {% if products %}
        <ol class="product-list" id="products-screen-ol" style="top: 150px;">
          {% for each in products %}
            <li class="product">
                <a href="#" onclick="Dajaxice.pos.add_product_to_order_line(my_callback, {'product_id':{{ each.id }}, 'product_name':'{{ each.name }}', 'price':'{{ each.lst_price }}', 'mesa':'{{ mesa }}' });">
                    <div class="product-img">
                         <img alt="{{ each.name }}" src="data:image/png;base64,{{ each.product_image_small }}" />
                         <span class="price-tag">{{ each.lst_price }} &euro;</span>
                    </div>
                    <div class="product-name">
                        {{ each.name }}
                    </div>
                </a>
            </li>
          {% endfor %}
        </ol>
        {% else %}
            {% trans "No hay productos" %}
        {% endif %}
    </div>
{% endblock derecha %}
